<%- include("navbar.ejs") %>
<br><br><br>

<style>
  .cart-container {
    padding: 60px 0;
    background: #fdfaf6;
  }

  .cart-title {
    font-weight: 700;
    color: #333;
  }

  .cart-item {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.06);
  }

  .cart-item img {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 10px;
  }

  .cart-summary {
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.06);
  }

  .btn-remove {
    color: red;
    border: none;
    background: none;
    font-weight: 600;
  }

  .btn-checkout {
    background: #ffc107;
    color: #000;
    font-weight: 600;
  }

  .btn-checkout:hover {
    background: #e0a800;
  }

  .text-strike {
    text-decoration: line-through;
    color: #888;
  }
</style>

<section class="cart-container">
  <div class="container">
    <h2 class="cart-title mb-4">ðŸ›’ Your Cart</h2>

    <div class="row">
      <!-- Cart Items -->
      <div class="col-md-8">
        <% if (cart && cart.length > 0) { %>
          <% let total = 0; let totalSavings = 0; %>
          <% for (let item of cart) { 
              const itemTotal = item.discount_price * item.quantity;
              total += itemTotal;

              const itemSavings = (item.price - item.discount_price) * item.quantity;
              totalSavings += itemSavings;
          %>
            <div class="cart-item d-flex align-items-center gap-4">
              <img src="/uploads/<%= item.image %>" alt="Product" />
              <div class="flex-grow-1">
               <h5 class="mb-1">
  <%= item.product_name %>
  <span class="badge bg-light text-dark border ms-2"> <%= item.weight %> </span>
</h5>

                <p class="mb-1">
                  <span class="text-strike">â‚¹<%= item.price %></span>
                  <span class="fw-semibold ms-2 text-success">â‚¹<%= item.discount_price %> Ã— <%= item.quantity %></span>
                </p>
                <p class="mb-1 fw-bold text-dark">Item Total: â‚¹<%= itemTotal.toFixed(2) %></p>
                <% if (item.price > item.discount_price) { %>
                  <small class="text-muted">You saved â‚¹<%= (item.price - item.discount_price) * item.quantity %></small>
                <% } %>
              </div>

              <a href="/remove_cart/<%= item.cart_id %>" onclick="return confirm('Are you sure you want to remove this item?');" class="btn-remove text-decoration-none">
                Remove
              </a>
            </div>
          <% } %>
        <% } else { %>
          <div class="alert alert-info">
            Your cart is empty.
          </div>
        <% } %>
      </div>

      <!-- Summary -->
     <!-- Summary -->
<div class="col-md-4">
  <% if (cart && cart.length > 0) { 
       let total = 0;
       let totalSavings = 0;
       for (let item of cart) {
         total += item.discount_price * item.quantity;
         totalSavings += (item.price - item.discount_price) * item.quantity;
       }
  %>
    <div class="cart-summary">
      <h5 class="mb-3">Order Summary</h5>
      <p class="mb-2">Items: <strong><%= cart.length %></strong></p>
      <p class="mb-2">Total: <strong>â‚¹<%= total.toFixed(2) %></strong></p>
      <% if (totalSavings > 0) { %>
        <p class="mb-2 text-success">You saved: <strong>â‚¹<%= totalSavings.toFixed(2) %></strong></p>
      <% } %>
      <a href="/checkout" class="btn btn-checkout w-100 mt-3">Proceed to Checkout</a>
    </div>
  <% } %>
</div>

</section>

<%- include("footer.ejs") %>
